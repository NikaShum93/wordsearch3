<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Wordsearch by Nika Shum</title>
  <style>
    :root {
      --main-color: #00ffff;
      --text-color: #00ffff;
      --border-color: #00ffff;
      --cell-bg: rgba(255,255,255,0.8);
      --grid-gap: 7px;
      --cell-size: 44px;
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100vw; height: 100vh;
      background: transparent;
      font-family: 'Orbitron', Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #container {
      display: flex;
      flex-direction: column;
      gap: 30px;
      align-items: center;
      width: 940px;
      max-width: 100vw;
      justify-content: center;
    }

    #game {
      position: relative;
    }

    #gridArea {
      display: flex;
      gap: 20px;
      position: relative;
    }

    #grid {
      display: grid;
      grid-template-columns: repeat(var(--n), var(--cell-size));
      grid-auto-rows: var(--cell-size);
      gap: var(--grid-gap);
    }

    .cell {
      width: var(--cell-size);
      height: var(--cell-size);
      background: var(--cell-bg);
      border: 2px solid var(--border-color);
      color: var(--text-color);
      font-weight: bold;
      font-size: 23px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: 0.18s;
    }

    .cell.selected {
      background: #ffff00;
      color: #222;
      box-shadow: 0 0 12px 4px #ffff00;
    }

    .cell.correct {
      background: #38ff8e;
      color: #000;
      box-shadow: 0 0 16px #32ffd6;
    }

    .cell.error {
      animation: error-blink 0.22s 2;
    }
    @keyframes error-blink {
      0%,100% { background: #e74c3c; color: #fff; }
      50% { background: #fff; color: #e74c3c; }
    }

    /* Word list */
#wordsList {
  position: absolute;
  display: flex;
  list-style: none;
  margin: 0;
  padding: 8px;
  gap: 12px;
  border-radius: 13px;
  background: none;
  font-size: 18px;
  max-height: 80vh;
  overflow-y: auto;
  z-index: 5;
}
#wordsList.bottom {
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  flex-direction: row;
}
#wordsList.top {
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  flex-direction: row;
}
#wordsList.left {
  top: 50%;
  left: 16px;
  transform: translateY(-50%);
  flex-direction: column;
}
#wordsList.right {
  top: 50%;
  right: 16px;
  transform: translateY(-50%);
  flex-direction: column;
}
#wordsList.none {
  display: none;
}
    #wordsList li {
      padding: 6px 8px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      background: var(--cell-bg);
      color: var(--text-color);
    }
    #wordsList li.found {
      text-decoration: line-through;
      color: #888;
      background: #aaffc66a;
      border-color: #8eeabd;
    }

    /* Message box */
    #messageBox {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%,-50%) scale(0.8);
      padding: 34px 60px;
      border-radius: 20px;
      background: var(--cell-bg);
      border: 2px solid var(--border-color);
      color: var(--text-color);
      font-size: 26px;
      font-weight: bold;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s, transform .3s;
      z-index: 10;
    }
    #messageBox.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%,-50%) scale(1);
    }

    /* Neon and rainbow */
    .neon .cell {
      box-shadow: 0 0 12px var(--main-color), 0 0 28px var(--main-color);
    }
    .cell.rainbow {
      animation: rainbowGlow 2.5s linear infinite;
    }
    @keyframes rainbowGlow {
      0% { box-shadow: 0 0 12px #ff0088; }
      25% { box-shadow: 0 0 12px #00ffff; }
      50% { box-shadow: 0 0 12px #00ff55; }
      75% { box-shadow: 0 0 12px #ffaa00; }
      100% { box-shadow: 0 0 12px #ff0088; }
    }

    /* Sparkles */
    .sparkle {
      position: absolute;
      width: 8px; height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle,#fff 55%,#38ffec 70%,#ee55ff 90%,transparent);
      pointer-events: none;
      animation: sparkle-move 0.85s forwards;
    }
    @keyframes sparkle-move {
      0% { opacity: 1; transform: scale(1); }
      90% { opacity: 0.8; }
      100% { opacity: 0; transform: translate(var(--tx),var(--ty)) scale(0.2); }
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="game">
      <div id="gridArea">
        <div id="grid"></div>
        <ul id="wordsList"></ul>
      </div>
      <div id="messageBox"></div>
    </div>
  </div>

  <audio id="clickSound" src="https://nikashum93.github.io/wordsearch/click.mp3" preload="auto"></audio>
  <audio id="errorSound" src="https://nikashum93.github.io/wordsearch/error.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://nikashum93.github.io/wordsearch/win.mp3" preload="auto"></audio>

  <script>
  // 1. Читаем все параметры из редактора
const params      = new URLSearchParams(window.location.search);
const wordsList   = (params.get("words") || "").split(/[\n,]+/).map(w=>w.trim()).filter(Boolean);
const alphabet    = params.get("alphabet")    || "latin";
const caseType    = params.get("case")        || "uppercase";
const level       = params.get("level")       || "medium";
const winText     = decodeURIComponent(params.get("winText") || "Ты нашёл все слова!");
const styleType   = params.get("style")       || "light";
const neon        = params.get("neon")==="1";
const neonColor   = "#" + (params.get("neonColor") || "00ffff");
const sparklesOn  = params.get("sparkles")==="1";
const bgColor     = "#" + (params.get("bgColor")      || "ffffff");
const borderColor = "#" + (params.get("borderColor")  || "00ffff");
const textColor   = "#" + (params.get("textColor")    || "00ffff");
const gridSize    = parseInt(params.get("gridSize")   || "10",10);
const wordsPos    = params.get("wordsListPosition")   || "bottom";


    // настрйока темы
    document.documentElement.style.setProperty('--n', gridSize);
    document.documentElement.style.setProperty('--cell-bg', bgColor);
    document.documentElement.style.setProperty('--border-color', borderColor);
    document.documentElement.style.setProperty('--text-color', textColor);
    if(styleType==="rainbow") document.body.classList.add("rainbow");
    if(neon) {
      document.body.classList.add("neon");
      document.documentElement.style.setProperty('--main-color', neonColor);
    }// 2. Находим элементы
const gridArea    = document.getElementById("gridArea");
const gridEl      = document.getElementById("grid");
const wordsEl     = document.getElementById("wordsList");
const messageBox  = document.getElementById("messageBox");
const clickSound  = document.getElementById("clickSound");
const errorSound  = document.getElementById("errorSound");
const winSound    = document.getElementById("winSound");
// 3. Применяем позицию списка
wordsEl.className = "";
wordsEl.classList.add(wordsPos);

// 4. Применяем тему и цвета (CSS-переменные)
document.documentElement.style.setProperty('--n', gridSize);
document.documentElement.style.setProperty('--cell-bg', bgColor);
document.documentElement.style.setProperty('--border-color', borderColor);
document.documentElement.style.setProperty('--text-color', textColor);
if (styleType === "rainbow") document.body.classList.add("rainbow");
if (neon) {
  document.body.classList.add("neon");
  document.documentElement.style.setProperty('--main-color', neonColor);
}
    // алфавиты
    const alphabets = {
      latin: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      cyrillic: "АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ",
      french: "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      german: "ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜß",
      spanish:"ABCDEFGHIJKLMNÑOPQRSTUVWXYZ",
      pinyin:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",
      hiragana:"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをん"
    };
    const alphabetSet = alphabets[alphabet]||alphabets.latin;

    // форматирование слова
    function formatWord(w) {
      return [...w.normalize('NFD').replace(/[\u0300-\u036f]/g,'')]
        .map(ch=>caseType==="lowercase"?ch.toLowerCase():ch.toUpperCase())
        .filter(ch=>alphabetSet.includes(ch));
    }

    // создаём пустую сетку
    const grid = Array.from({length:gridSize},()=>Array(gridSize).fill(""));

    // размещаем слова
    const placements = [];
    function placeWords() {
      // очистка
      for(let y=0;y<gridSize;y++)
        for(let x=0;x<gridSize;x++) grid[y][x]="";
      placements.length=0;

      // вставка
      wordsList.forEach(raw=>{
        const w = formatWord(raw);
        let placed=false;
        const dirs = {
          easy: [[1,0],[0,1]],
          medium:[[1,0],[0,1],[1,1]],
          hard: [[1,0],[0,1],[1,1],[-1,1],[1,-1],[0,-1],[-1,0],[-1,-1]]
        }[level];

        for(let t=0;t<200 && !placed;t++){
          const [dx,dy] = dirs[Math.floor(Math.random()*dirs.length)];
          const x0 = Math.floor(Math.random()*gridSize);
          const y0 = Math.floor(Math.random()*gridSize);
          let ok=true;
          for(let i=0;i<w.length;i++){
            const x=x0+dx*i, y=y0+dy*i;
            if(x<0||y<0||x>=gridSize||y>=gridSize|| (grid[y][x] && grid[y][x]!==w[i])){
              ok=false; break;
            }
          }
          if(!ok) continue;
          for(let i=0;i<w.length;i++){
            grid[y0+dy*i][x0+dx*i]=w[i];
          }
          placements.push({word:w, start:{x:x0,y:y0}, dir:{dx,dy}});
          placed=true;
        }
      });

      // рандомные буквы
      for(let y=0;y<gridSize;y++)
        for(let x=0;x<gridSize;x++)
          if(!grid[y][x])
            grid[y][x] = alphabetSet[Math.floor(Math.random()*alphabetSet.length)];
    }

    // убираем лишние вхождения
    function findMatches(w){
      const res=[];
      const L=w.length;
      const dirs=[[1,0],[0,1],[1,1],[-1,1],[1,-1],[0,-1],[-1,0],[-1,-1]];
      for(let y=0;y<gridSize;y++)for(let x=0;x<gridSize;x++){
        dirs.forEach(([dx,dy])=>{
          let ok=true;
          for(let i=0;i<L;i++){
            const xx=x+dx*i, yy=y+dy*i;
            if(xx<0||yy<0||xx>=gridSize||yy>=gridSize||grid[yy][xx]!==w[i]){
              ok=false; break;
            }
          }
          if(ok) res.push({start:{x,y},dir:{dx,dy}});
        });
      }
      return res;
    }

    function removeAcc(w,start,dir){
      const key=JSON.stringify({start,dir});
      for(let pass=0;pass<5;pass++){
        const all=findMatches(w);
        const extra=all.filter(m=>JSON.stringify(m)!==key);
        if(!extra.length) break;
        extra.forEach(({start,dir})=>{
          const i=Math.floor(Math.random()*w.length);
          const x=start.x+dir.dx*i, y=start.y+dir.dy*i;
          let c;
          do{c=alphabetSet[Math.floor(Math.random()*alphabetSet.length)]}
          while(c===grid[y][x]);
          grid[y][x]=c;
        });
      }
    }

    function placeAll(){
      placeWords();
      placements.forEach(p=>removeAcc(p.word,p.start,p.dir));
    }

    // рендеринг
    function renderGrid(){
      gridEl.innerHTML="";
      placements.length; // ensure placed
      for(let y=0;y<gridSize;y++){
        for(let x=0;x<gridSize;x++){
          const cell=document.createElement("div");
          cell.className="cell";
          if(styleType==="rainbow") cell.classList.add("rainbow");
          cell.dataset.x=x; cell.dataset.y=y;
          cell.textContent=grid[y][x];
          gridEl.appendChild(cell);
        }
      }
    }

    // список слов
    let found=[];
    function updateWordList(){
      wordsEl.innerHTML="";
      wordsList.forEach(raw=>{
        const w=formatWord(raw).join("");
        const li=document.createElement("li");
        li.textContent=w;
        if(found.includes(w)) li.classList.add("found");
        wordsEl.appendChild(li);
      });
    }

    // interaction
    let sel=[];
    function clearSel(err){
      sel.forEach(c=>{
        c.classList.remove("selected");
        if(err){
          c.classList.add("error");
          setTimeout(()=>c.classList.remove("error"),350);
        }
      });
      sel=[];
    }

    function checkLine(){
      if(sel.length<2) return false;
      const dx=sel[sel.length-1].dataset.x - sel[0].dataset.x;
      const dy=sel[sel.length-1].dataset.y - sel[0].dataset.y;
      return dx===0||dy===0||Math.abs(dx)===Math.abs(dy);
    }

    function handleClick(e){
      if(!e.target.classList.contains("cell")) return;
      const c=e.target;
      clickSound.currentTime=0; clickSound.play();
      if(sel.includes(c)) return;
      c.classList.add("selected");
      sel.push(c);
      const word=sel.map(c=>c.textContent).join("");
      if(wordsList.map(w=>formatWord(w).join("")).includes(word) && checkLine()){
        sel.forEach(c=>{c.classList.add("correct");c.classList.remove("selected");});
        found.push(word);
        updateWordList();
        sel=[];
        if(found.length===wordsList.length){
          winSound.play();
          document.querySelectorAll(".cell").forEach(c=>c.classList.add("rainbow"));
          setTimeout(()=>{
            msgBox.textContent=winText;
            msgBox.classList.add("show");
          },650);
        }
      } else {
        const partial = wordsList.some(raw=>
          formatWord(raw).join("").startsWith(sel.map(c=>c.textContent).join(""))
        );
        if(!partial||sel.length>Math.max(...wordsList.map(raw=>formatWord(raw).length))){
          errorSound.currentTime=0; errorSound.play();
          clearSel(true);
        }
      }
    }

    // sparkles
    function createSparkles(x,y){
      for(let i=0;i<13;i++){
        const s=document.createElement("div");
        s.className="sparkle";
        s.style.left=x+"px"; s.style.top=y+"px";
        const ang=Math.random()*2*Math.PI, dist=21+Math.random()*18;
        s.style.setProperty('--tx',Math.cos(ang)*dist+"px");
        s.style.setProperty('--ty',Math.sin(ang)*dist+"px");
        document.getElementById("gridArea").appendChild(s);
        setTimeout(()=>s.remove(),850+Math.random()*150);
      }
    }

    // старт
applyTheme();
placeWords();
renderGrid();
updateWordList();
gridEl.addEventListener("click", handleClick);
      }
    });
  </script>
</body>
</html>
